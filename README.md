# ğŸ”¥ Wildfire Damage Evaluation Algorithm Module

### **ç¾æŸè¯„ä¼°ç®—æ³•æ¨¡å— READMEï¼ˆå¯¹æ¥ç³»ç»Ÿæ¥å£ä¸“ç”¨ç‰ˆï¼‰**

æœ¬é¡¹ç›®å®ç°äº†ç¾æŸè¯„ä¼°ç³»ç»Ÿä¸­çš„ **â€œå›¾ç‰‡åˆæˆç®—æ³•æ¨¡å—ï¼ˆå¯é€‰ï¼‰â€** ä¸ **â€œç¾æŸè¯„ä¼°ç®—æ³•æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰â€**ã€‚
æ¨¡å—é€šè¿‡æ ‡å‡†æ¥å£æ¥æ”¶ä»»åŠ¡ä¿¡æ¯ï¼Œå¯¹å›¾åƒè¿›è¡Œåˆ†å‰²ç”Ÿæˆç«çƒ§è¿¹åœ°æ©ç ï¼Œå¹¶è®¡ç®—è¿‡ç«é¢ç§¯ä¸ç»æµæŸå¤±ï¼Œæœ€ç»ˆé€šè¿‡å›è°ƒæ¥å£å‘ä¸»ç³»ç»Ÿè¿”å›è¯„ä¼°ç»“æœã€‚

æœ¬ README ä»…åŒ…å«ä½ éœ€è¦åœ¨éƒ¨ç½²æ—¶å¯¹æ¥ç³»ç»Ÿçš„å…³é”®ä¿¡æ¯ã€‚

---

# ğŸ“ ç›®å½•

* [1. æ¨¡å—ç®€ä»‹](#æ¨¡å—ç®€ä»‹)
* [2. æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)
* [3. ç¯å¢ƒä¾èµ–](#ç¯å¢ƒä¾èµ–)
* [4. æœåŠ¡å¯åŠ¨æ–¹å¼](#æœåŠ¡å¯åŠ¨æ–¹å¼)
* [5. å›¾ç‰‡åˆæˆç®—æ³•æ¨¡å—æ¥å£ï¼ˆå¯é€‰ï¼‰](#å›¾ç‰‡åˆæˆç®—æ³•æ¨¡å—æ¥å£å¯é€‰)
* [6. ç¾æŸè¯„ä¼°ç®—æ³•æ¨¡å—æ¥å£ï¼ˆæ ¸å¿ƒï¼‰](#ç¾æŸè¯„ä¼°ç®—æ³•æ¨¡å—æ¥å£æ ¸å¿ƒ)
* [7. é¢ç§¯è®¡ç®—é€»è¾‘](#é¢ç§¯è®¡ç®—é€»è¾‘)
* [8. å…³é”®å›è°ƒæ¥å£](#å…³é”®å›è°ƒæ¥å£)
* [9. å®Œæ•´ä¸šåŠ¡æµç¨‹](#å®Œæ•´ä¸šåŠ¡æµç¨‹)
* [10. æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

# 1. æ¨¡å—ç®€ä»‹

æœ¬é¡¹ç›®è´Ÿè´£ä»¥ä¸‹å·¥ä½œï¼š

### ğŸ–¼ï¸ **å›¾ç‰‡åˆæˆï¼ˆå¯é€‰ï¼‰**

ç³»ç»Ÿè§¦å‘åï¼Œå¯ç”±æ¨¡å—ç”Ÿæˆåˆæˆå›¾ï¼ˆè‹¥ç³»ç»Ÿå·²æœ‰åˆæˆå›¾ï¼Œå¯è·³è¿‡ï¼‰ã€‚

### ğŸ”¥ **ç¾æŸè¯„ä¼°ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**

* ä¸‹è½½åˆæˆå›¾ï¼ˆsynthesizedImageUrlï¼‰
* ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œåˆ†å‰²ï¼ˆç”Ÿæˆ maskï¼‰
* ä½¿ç”¨ `Detection_and_calculate.py` è®¡ç®—ï¼š

  * çº¢è‰²åƒç´ æ¯”ä¾‹
  * è¿‡ç«é¢ç§¯ï¼ˆã¡ï¼‰
  * ç»æµæŸå¤±ï¼ˆå…ƒï¼‰
* ä¸Šä¼ æ©ç å›¾
* å›è°ƒä¸»ç³»ç»Ÿ `/admin/evaluation/callback`

æ‰€æœ‰å­—æ®µã€æ¥å£å‘½åå’Œæµç¨‹å‡éµå¾ªç³»ç»Ÿæ¥å£è§„èŒƒã€‚

---

# 2. æ–‡ä»¶ç»“æ„

```
.
â”œâ”€â”€ app.py                      # FastAPI æœåŠ¡ï¼Œå®ç°å¯¹æ¥ API
â”œâ”€â”€ Detection_and_calculate.py  # æ©ç ç»Ÿè®¡ + é¢ç§¯è®¡ç®—è„šæœ¬
â”œâ”€â”€ models/                     # wildfire segmentation model
â”œâ”€â”€ results/                    # è¾“å‡ºæ©ç å›¾
â”œâ”€â”€ uploads/                    # ä¸‹è½½çš„è¾“å…¥å›¾
â””â”€â”€ README.md
```

---

# 3. ç¯å¢ƒä¾èµ–

```
Python >= 3.8

pip install fastapi uvicorn pillow numpy opencv-python torch torchvision requests
```

---

# 4. æœåŠ¡å¯åŠ¨æ–¹å¼

```
uvicorn app:app --host 0.0.0.0 --port 8000
```

å¯åŠ¨åæ¨¡å—å°†æš´éœ²ï¼š

| ç±»å‹ | API                                  |
| -- | ------------------------------------ |
| å¯é€‰ | `/api/synthesis/generate`            |
| æ ¸å¿ƒ | `/api/algorithm/generate-evaluation` |

---

# 5. å›¾ç‰‡åˆæˆç®—æ³•æ¨¡å—æ¥å£ï¼ˆå¯é€‰ï¼‰

å¦‚ç³»ç»Ÿå·²æœ‰åˆæˆå›¾ï¼Œå¯ä¸å®ç°çœŸå®åˆæˆåŠŸèƒ½ï¼Œä»…ç¡®ä¿ API å­˜åœ¨å¹¶èƒ½æ­£å¸¸å›è°ƒã€‚

---

## ğŸ“Œ POST /api/synthesis/generate

ç³»ç»Ÿè§¦å‘å›¾ç‰‡åˆæˆï¼š

### è¯·æ±‚ç¤ºä¾‹

```json
{
  "missionId": 1001
}
```

### æ¨¡å—åº”åšçš„äº‹

1. è·å– `missionId`
2. ï¼ˆå¯é€‰ï¼‰ä¸‹è½½åŸå›¾
3. å®Œæˆå›¾ç‰‡åˆæˆï¼ˆæˆ–ç›´æ¥è¿”å›åŸå›¾ï¼‰
4. ä¸Šä¼ å¹¶è·å¾— `synthesizedImageUrl`
5. å›è°ƒç³»ç»Ÿï¼š`POST /admin/synthesis/callback`

---

### ğŸ“Œ å›è°ƒæ ¼å¼ï¼ˆå¿…é¡»ï¼‰

```json
{
  "missionId": 1001,
  "synthesizedImageUrl": "https://your-host/syn_1001.jpg",
  "realWorldWidthMeters": 1000.0,
  "realWorldHeightMeters": 800.0,
  "status": "success"
}
```

ç³»ç»Ÿæ”¶åˆ°åä¼šè‡ªåŠ¨è§¦å‘ç¾æŸè¯„ä¼°ã€‚

---

# 6. ç¾æŸè¯„ä¼°ç®—æ³•æ¨¡å—æ¥å£ï¼ˆæ ¸å¿ƒï¼‰

ä½ çš„ **app.py** çš„ä¸»è¦ä»»åŠ¡ã€‚

---

## ğŸ“Œ POST /api/algorithm/generate-evaluation

ç³»ç»Ÿåœ¨å®Œæˆå›¾ç‰‡åˆæˆå›è°ƒåè‡ªåŠ¨è°ƒç”¨ã€‚

### è¯·æ±‚å†…å®¹ï¼ˆæ¥è‡ªç³»ç»Ÿï¼‰

```json
{
  "missionId": 1001,
  "synthesizedImageUrl": "https://oss.example.com/synthesis/syn_1001.jpg",
  "realWorldWidthMeters": 1000.0,
  "realWorldHeightMeters": 800.0
}
```

---

## æ¨¡å—å¤„ç†æ­¥éª¤ï¼ˆä¸ app.py ä¸€è‡´ï¼‰

1. è§£æå‚æ•°
2. ä¸‹è½½åˆæˆå›¾
3. æ‰§è¡Œåˆ†å‰²æ¨¡å‹ â†’ å¾—åˆ° mask
4. ä¿å­˜ mask åˆ°ï¼š

   ```
   results/<missionId>/mask_xxx.png
   ```
5. ä½¿ç”¨ Detection_and_calculate.py è®¡ç®—é¢ç§¯
6. è®¡ç®—ç»æµæŸå¤±ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
7. ä¸Šä¼ æ©ç å›¾
8. è°ƒç”¨ä¸»ç³»ç»Ÿå›è°ƒï¼š `/admin/evaluation/callback`

---

## ğŸ“Œ å›è°ƒå†…å®¹ï¼ˆå¿…é¡»ä¸ç³»ç»Ÿè§„èŒƒä¸€è‡´ï¼‰

```json
{
  "missionId": 1001,
  "maskImageUrl": "https://your-host/masks/mask_1001.png",
  "burnedArea": 15600.5,
  "economicLoss": 320000.0
}
```

---

# 7. é¢ç§¯è®¡ç®—é€»è¾‘

ç”± `Detection_and_calculate.py` å®Œæˆï¼š

### è¾“å…¥

* æ©ç å›¾ç‰‡ï¼ˆçº¢è‰²åŒºåŸŸè¡¨ç¤ºçƒ§æ¯åŒºåŸŸï¼‰
* çœŸå®ä¸–ç•Œå®½åº¦ã€é«˜åº¦ï¼ˆç±³ï¼‰

### è¾“å‡ºå†…å®¹ç¤ºä¾‹

```
çº¢è‰²åƒç´  = 103920
æ€»åƒç´  = 512000
çº¢è‰²æ¯”ä¾‹ = 20.29%
è¿‡ç«é¢ç§¯ = 15600.5 m^2
```

### é¢ç§¯æ¢ç®—å…¬å¼

```
pixel_size_width  = realWorldWidthMeters / image_width
pixel_size_height = realWorldHeightMeters / image_height

pixel_real_area = pixel_size_width * pixel_size_height

burnedArea = red_pixels * pixel_real_area
```

ç»æµæŸå¤±å¯æ ¹æ®ä¸šåŠ¡è§„åˆ™è‡ªå®šä¹‰ã€‚

---

# 8. å…³é”®å›è°ƒæ¥å£

ä»¥ä¸‹ä¸¤ä¸ªæ¥å£ä¸ºä¸»ç³»ç»Ÿæä¾›ï¼Œä½ çš„æ¨¡å—å¿…é¡»ä»¥æ­¤æ ¼å¼å›è°ƒï¼š

---

## ğŸ”„ å›¾ç‰‡åˆæˆå›è°ƒ

`POST /admin/synthesis/callback`

```json
{
  "missionId": 1001,
  "synthesizedImageUrl": "https://your-host/syn_1001.jpg",
  "realWorldWidthMeters": 1000.0,
  "realWorldHeightMeters": 800.0,
  "status": "success"
}
```

---

## ğŸ”„ ç¾æŸè¯„ä¼°å›è°ƒ

`POST /admin/evaluation/callback`

```json
{
  "missionId": 1001,
  "maskImageUrl": "https://your-host/masks/mask_1001.png",
  "burnedArea": 15600.5,
  "economicLoss": 320000.0
}
```

---

# 9. å®Œæ•´ä¸šåŠ¡æµç¨‹ï¼ˆç¬¦åˆå¯¹æ¥æ–‡æ¡£ï¼‰

```
ç³»ç»Ÿè§¦å‘è¯„ä¼°
   â†“
POST /api/synthesis/generate ï¼ˆå¯é€‰ï¼‰
   â†“
POST /admin/synthesis/callbackï¼ˆä½ å›è°ƒç³»ç»Ÿï¼‰
   â†“
ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ç¾æŸè¯„ä¼°æ¨¡å—
POST /api/algorithm/generate-evaluation
   â†“
æ¨¡å‹æ¨ç† + æ©ç ç”Ÿæˆ + é¢ç§¯è®¡ç®—
   â†“
POST /admin/evaluation/callbackï¼ˆä½ å›è°ƒç³»ç»Ÿï¼‰
```

æµç¨‹æ¥è‡ªäº’è”æ¨¡å—æ–‡æ¡£è§„èŒƒã€‚

---

# 10. æ³¨æ„äº‹é¡¹

* æ‰€æœ‰ URL å¿…é¡»æ˜¯å¯å…¬ç½‘è®¿é—®çš„ï¼ˆOSS / æœ¬åœ°åå‘ä»£ç†ï¼‰
* æ©ç å»ºè®®ä¸º PNGï¼ˆä¿æŒé¢œè‰²ä¸€è‡´ï¼‰
* çº¢è‰²åƒç´ éœ€ä½¿ç”¨ç»Ÿä¸€æ ‡å‡†ï¼š`(R=255, G=0, B=0)`
* å›è°ƒå¤±è´¥éœ€é‡è¯•æˆ–è®°å½•æ—¥å¿—
* missionId å¿…é¡»åŸæ ·è¿”å›
